<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∏–±–æ–ª–æ–≤–ª—è</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
        }

        .fishing-area {
            margin-top: 50px;
        }

        .action-button {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        .back-button {
            margin-top: 20px;
            padding: 10px;
            background-color: #444;
            color: white;
            border: none;
            cursor: pointer;
        }

        #fish-status {
            font-size: 20px;
            margin-top: 30px;
        }

        .coin-display {
            font-size: 18px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="fishing-area">
        <h1 id="location-title"></h1>
        <p id="fish-status">–ó–∞–∫–∏–Ω—å—Ç–µ –≤—É–¥–æ—á–∫—É, —â–æ–± –ø–æ—á–∞—Ç–∏ –ª–æ–≤–∏—Ç–∏ —Ä–∏–±—É.</p>
        <button id="cast-button" class="action-button" onclick="startFishing()">üé£ –ó–∞–∫–∏–Ω—É—Ç–∏ –≤—É–¥–æ—á–∫—É</button>
        <button id="pull-button" class="action-button" onclick="pullFish()" style="display: none;">üêü –ü—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ —Ä–∏–±—É</button>
        <button class="action-button" onclick="window.location.href='backpack.html'">üéí –†—é–∫–∑–∞–∫</button>
        <button class="back-button" onclick="goBack()">‚¨Ö –ù–∞–∑–∞–¥</button>
        <div class="coin-display">üí∞ –ú–æ–Ω–µ—Ç–∏: <span id="coin-count">0</span></div>
    </div>

    <script>
        // –û—Ç—Ä–∏–º—É—î–º–æ –æ–±—Ä–∞–Ω—É –ª–æ–∫–∞—Ü—ñ—é –∑ localStorage
        const selectedLocation = localStorage.getItem('selectedLocation');
        const fishStatus = document.getElementById('fish-status');
        const castButton = document.getElementById('cast-button');
        const pullButton = document.getElementById('pull-button');
        const coinCountElement = document.getElementById('coin-count');

        let fishBiting = false; // –°—Ç–∞–Ω –∫–ª—é–≤–∞–Ω–Ω—è

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–Ω–µ—Ç
        let coins = parseInt(localStorage.getItem('coins')) || 0;
        coinCountElement.innerText = coins;

        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ñ–æ–Ω —ñ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ª–æ–∫–∞—Ü—ñ—ó
        if (selectedLocation === 'lake') {
            document.body.style.backgroundImage = "url('lake.jpg')";
            document.getElementById('location-title').innerText = "üé£ –†–∏–±–æ–ª–æ–≤–ª—è –Ω–∞ –û–∑–µ—Ä—ñ";
        } else if (selectedLocation === 'river') {
            document.body.style.backgroundImage = "url('river.jpg')";
            document.getElementById('location-title').innerText = "üé£ –†–∏–±–æ–ª–æ–≤–ª—è –Ω–∞ –†—ñ—á—Ü—ñ";
        }

        // –§—É–Ω–∫—Ü—ñ—è –∑–∞–∫–∏–¥–∞–Ω–Ω—è –≤—É–¥–æ—á–∫–∏
        function startFishing() {
            fishStatus.innerText = "–ß–µ–∫–∞–π—Ç–µ... –†–∏–±–∞ –º–æ–∂–µ –∫–ª—é–Ω—É—Ç–∏ –±—É–¥—å-—è–∫–æ—ó –º–∏—Ç—ñ!";
            castButton.style.display = "none"; // –•–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É –∑–∞–∫–∏–¥–∞–Ω–Ω—è
            fishBiting = false;

            // –í–∏–ø–∞–¥–∫–æ–≤–∏–π —á–∞—Å –¥–ª—è –∫–ª—é–≤–∞–Ω–Ω—è (3-8 —Å–µ–∫—É–Ω–¥)
            const biteTime = Math.floor(Math.random() * 5000) + 3000;

            setTimeout(() => {
                fishBiting = true;
                fishStatus.innerText = "üêü –ö–ª—é—î! –®–≤–∏–¥—à–µ –ø—ñ–¥—Ç—è–≥–Ω—ñ—Ç—å —Ä–∏–±—É!";
                pullButton.style.display = "inline-block"; // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É –ø—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è
            }, biteTime);
        }

        // –§—É–Ω–∫—Ü—ñ—è –ø—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ä–∏–±–∏
        function pullFish() {
            if (fishBiting) {
                fishStatus.innerText = "üéâ –í–∏ —Å–ø—ñ–π–º–∞–ª–∏ —Ä–∏–±—É! –ó–∞–∫–∏–Ω—å—Ç–µ –≤—É–¥–æ—á–∫—É —â–µ —Ä–∞–∑.";
                pullButton.style.display = "none"; // –•–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É –ø—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è
                castButton.style.display = "inline-block"; // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É –∑–∞–∫–∏–¥–∞–Ω–Ω—è

                // –î–æ–¥–∞—î–º–æ —Ä–∏–±—É –¥–æ —Ä—é–∫–∑–∞–∫–∞ (—Ç–∏–º—á–∞—Å–æ–≤–æ —É localStorage)
                const caughtFish = generateRandomFish();
                saveFishToBackpack(caughtFish);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó —Ä–∏–±–∏
        function generateRandomFish() {
            const fishTypes = [
                { name: "–û–∫—É–Ω—å", minWeight: 0.5, maxWeight: 1.5, pricePerKg: 10 },
                { name: "–©—É–∫–∞", minWeight: 2, maxWeight: 5, pricePerKg: 20 },
                { name: "–ö–æ—Ä–æ–ø", minWeight: 1, maxWeight: 4, pricePerKg: 15 }
            ];
            const fish = fishTypes[Math.floor(Math.random() * fishTypes.length)];
            const weight = (Math.random() * (fish.maxWeight - fish.minWeight) + fish.minWeight).toFixed(2);
            return { name: fish.name, weight, price: (weight * fish.pricePerKg).toFixed(2) };
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–∏–±–∏ —É —Ä—é–∫–∑–∞–∫
        function saveFishToBackpack(fish) {
            let backpack = JSON.parse(localStorage.getItem('backpack')) || [];
            backpack.push(fish);
            localStorage.setItem('backpack', JSON.stringify(backpack));
            alert(`–í–∏ —Å–ø—ñ–π–º–∞–ª–∏ ${fish.name} (${fish.weight} –∫–≥) –∑–∞ ${fish.price} –º–æ–Ω–µ—Ç!`);
        }

        // –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –≤–∏–±–æ—Ä—É –ª–æ–∫–∞—Ü—ñ—ó
        function goBack() {
            window.location.href = "locations.html";
        }
    </script>
</body>
</html>
